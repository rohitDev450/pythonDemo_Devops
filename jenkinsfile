pipeline {
    agent any
    environment{
        DOCKER_TAG = "${BUILD_NUMBER}"
        DOCKER_CREDS = credentials('Docker_user') 
    }

    stages {
        stage('Git Clone') {
            steps {
                git url:'https://github.com/rohitDev450/pythonDemo_Devops.git', branch:'main'
            }
       }
       stage('Docker Login') {
            steps {
                sh "echo $DOCKER_CREDS_PSW | docker login -u $DOCKER_CREDS_USR --password-stdin"
          }
       }
        stage('Docker Build') {
            steps {
                   sh "docker compose build "
            }
        }
         stage('Test Code') {
            steps {
                   echo "Code is testing by devloper"
            }
        }
        stage('Docker Image Push') {
            steps {
                sh "docker push rohitar/python-demo:${DOCKER_TAG}"
                    }
           }
        stage('Code Deploy') {
            steps {
                  sh "docker compose down --remove-orphans"
                   sh "docker compose up -d "
            }
          }
     }
}
